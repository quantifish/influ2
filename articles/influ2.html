<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="influ2">
<title>influ2 â€¢ influ2</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="influ2">
<meta property="og:description" content="influ2">
<meta property="og:image" content="http://www.quantifish.co.nz/influ2/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">influ2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/influ2.html">Get started</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/hurdle.html">hurdle</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/quantifish/influ2/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>influ2</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/quantifish/influ2/blob/HEAD/vignettes/influ2.Rmd" class="external-link"><code>vignettes/influ2.Rmd</code></a></small>
      <div class="d-none name"><code>influ2.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>influ2</code> package is based on the original
<code>influ</code> package which was developed to generate influence
statistics and associated plots. The <code>influ</code> package has
functions that use outputs from the <code>glm</code> function. The
<code>influ2</code> package was developed to use outputs from
<code>brms</code> and relies heavily on the R packages in the
<code>tidyverse</code> suite of packages. This vignette showcases the
<code>influ2</code> package.</p>
</div>
<div class="section level2">
<h2 id="functions-for-exploring-data">Functions for exploring data<a class="anchor" aria-label="anchor" href="#functions-for-exploring-data"></a>
</h2>
<p>In this vignette I use a simulated catch per unit effort (CPUE) data
set to model the number of lobsters caught per pot. This data set has a
response variable labelled <code>lobsters</code> and includes the
dependent variables <code>year</code> (from 2000 to 2017),
<code>month</code>, <code>depth</code> (in meters), and
<code>soak</code> (the soak time of each pot in hours). No step-wise
variable selection or model selection is done in this vignette.</p>
<p>The main function for exploring data in <code>influ2</code> is
<code>plot_bubble</code> which presents the number of records by two
user defined groups within a data set. The bubble size in
<code>plot_bubble</code> represents the number of records across the
entire data set, and bubbles can either be a single colour or coloured
by a third variable in the data set.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape" class="external-link">reshape2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paul-buerkner/brms" class="external-link">brms</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/quantifish/influ2" class="external-link">influ2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/bayesplot/" class="external-link">bayesplot</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>mc.cores <span class="op">=</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The simulated data set</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">lobsters_per_pot</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">lobsters_per_pot</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 15642</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">lobsters_per_pot</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 Ã— 5</span></span></span>
<span><span class="co">#&gt;   lobsters year  month depth  soak</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>        3 2000  01     29.9  25.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>        4 2000  01     16.4  39.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>        4 2000  01     11.9  26.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>        0 2000  01     18.6  26.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>        0 2000  01     33.8  24.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>        0 2000  01     21.0  24.2</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_bubble.html">plot_bubble</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">lobsters_per_pot</span>, group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span>, <span class="st">"month"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Month"</span>, y <span class="op">=</span> <span class="st">"Year"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="influ2_files/figure-html/plot-bubble-1-1.png" alt="Distribution of data by year and month." width="576"><p class="caption">
Distribution of data by year and month.
</p>
</div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_bubble.html">plot_bubble</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">lobsters_per_pot</span>, group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span>, <span class="st">"month"</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"month"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Month"</span>, y <span class="op">=</span> <span class="st">"Year"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="influ2_files/figure-html/plot-bubble-2-1.png" alt="Distribution of data by year and month, also coloured by month." width="576"><p class="caption">
Distribution of data by year and month, also coloured by month.
</p>
</div>
</div>
<div class="section level2">
<h2 id="the-origninal-influ-versus-influ2">The origninal influ versus influ2<a class="anchor" aria-label="anchor" href="#the-origninal-influ-versus-influ2"></a>
</h2>
<p>Two different models are fitted in <code>brms</code>. The first model
assumes a Poisson distributioin and includes the explanatory variables
<code>year</code>, <code>month</code>, and a 3rd order polynomial for
<code>soak</code> time. The second model assumes a negative binomial
distribution and includes the explanatory variables <code>year</code>,
<code>month</code> as a random effect, and a spline for
<code>depth</code> with 3 degrees of freedom.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brm.html" class="external-link">brm</a></span><span class="op">(</span><span class="va">lobsters</span> <span class="op">~</span> <span class="va">year</span> <span class="op">+</span> <span class="va">month</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">soak</span>, <span class="fl">3</span><span class="op">)</span>, </span>
<span>            data <span class="op">=</span> <span class="va">lobsters_per_pot</span>, family <span class="op">=</span> <span class="va">poisson</span>, </span>
<span>            chains <span class="op">=</span> <span class="fl">2</span>, iter <span class="op">=</span> <span class="fl">1500</span>, refresh <span class="op">=</span> <span class="fl">0</span>, seed <span class="op">=</span> <span class="fl">42</span>, </span>
<span>            file <span class="op">=</span> <span class="st">"fit1"</span>, file_refit <span class="op">=</span> <span class="st">"never"</span><span class="op">)</span></span>
<span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brm.html" class="external-link">brm</a></span><span class="op">(</span><span class="va">lobsters</span> <span class="op">~</span> <span class="va">year</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">month</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">depth</span>, k <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, </span>
<span>            data <span class="op">=</span> <span class="va">lobsters_per_pot</span>, family <span class="op">=</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brmsfamily.html" class="external-link">negbinomial</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>            control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>adapt_delta <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span>,</span>
<span>            chains <span class="op">=</span> <span class="fl">2</span>, iter <span class="op">=</span> <span class="fl">3000</span>, refresh <span class="op">=</span> <span class="fl">0</span>, seed <span class="op">=</span> <span class="fl">1</span>, </span>
<span>            file <span class="op">=</span> <span class="st">"fit2"</span>, file_refit <span class="op">=</span> <span class="st">"never"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">criterion</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"loo"</span>, <span class="st">"waic"</span>, <span class="st">"bayes_R2"</span><span class="op">)</span></span>
<span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/add_criterion.html" class="external-link">add_criterion</a></span><span class="op">(</span><span class="va">fit1</span>, criterion <span class="op">=</span> <span class="va">criterion</span>, file <span class="op">=</span> <span class="st">"fit1"</span><span class="op">)</span></span>
<span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/add_criterion.html" class="external-link">add_criterion</a></span><span class="op">(</span><span class="va">fit2</span>, criterion <span class="op">=</span> <span class="va">criterion</span>, file <span class="op">=</span> <span class="st">"fit2"</span><span class="op">)</span></span></code></pre></div>
<p>Fit a model using glm and generate influence statistics using the
original <code>influ</code> package</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_glm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">lobsters</span> <span class="op">~</span> <span class="va">year</span> <span class="op">+</span> <span class="va">month</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">soak</span>, <span class="fl">3</span><span class="op">)</span>, </span>
<span>               data <span class="op">=</span> <span class="va">lobsters_per_pot</span>, family <span class="op">=</span> <span class="va">poisson</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myInfl</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Influence.html">Influence</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>model <span class="op">=</span> <span class="va">fit_glm</span><span class="op">)</span></span>
<span><span class="va">myInfl</span><span class="op">$</span><span class="fu">init</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">myInfl</span><span class="op">$</span><span class="fu">calc</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">myInfl</span><span class="op">$</span><span class="fu">cdiPlot</span><span class="op">(</span>term <span class="op">=</span> <span class="st">"month"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="influ2_files/figure-html/unnamed-chunk-3-1.png" alt="The original CDI plot from the influ package." width="576"><p class="caption">
The original CDI plot from the influ package.
</p>
</div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdi_month</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_bayesian_cdi.html">plot_bayesian_cdi</a></span><span class="op">(</span>fit <span class="op">=</span> <span class="va">fit1</span>, xfocus <span class="op">=</span> <span class="st">"month"</span>, yfocus <span class="op">=</span> <span class="st">"year"</span>, </span>
<span>                               xlab <span class="op">=</span> <span class="st">"Month"</span>, ylab <span class="op">=</span> <span class="st">"Year"</span><span class="op">)</span></span>
<span><span class="va">cdi_month</span></span></code></pre></div>
<div class="figure">
<img src="influ2_files/figure-html/plot-cdi-fe-1.png" alt="The new Bayesian CDI plot from the influ2 package." width="576"><p class="caption">
The new Bayesian CDI plot from the influ2 package.
</p>
</div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myInfl</span><span class="op">$</span><span class="fu">stepPlot</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="influ2_files/figure-html/unnamed-chunk-4-1.png" alt="The original step-plot from the influ package." width="576"><p class="caption">
The original step-plot from the influ package.
</p>
</div>
<p>The <code>influ2</code> package cannot generate steps plots
automatically like <code>influ</code>. Each step must be modelled
separately and then a list of models defined as below.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fit1</span>, <span class="va">fit2</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_step.html">plot_step</a></span><span class="op">(</span>fits <span class="op">=</span> <span class="va">fits</span>, year <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="influ2_files/figure-html/unnamed-chunk-5-1.png" alt="The new Bayesian step-plot from the influ2 package. Note that the new step-plot requires that all models/steps be run in brms before the function can be used." width="576"><p class="caption">
The new Bayesian step-plot from the influ2 package. Note that the new
step-plot requires that all models/steps be run in brms before the
function can be used.
</p>
</div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_index.html">plot_index</a></span><span class="op">(</span><span class="va">fit2</span>, year <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span></span></code></pre></div>
<p><img src="influ2_files/figure-html/unnamed-chunk-6-1.png" width="576"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myInfl</span><span class="op">$</span><span class="fu">stanPlot</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="influ2_files/figure-html/unnamed-chunk-7-1.png" width="576"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_influ.html">plot_influ</a></span><span class="op">(</span>fit <span class="op">=</span> <span class="va">fit1</span>, year <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span></span></code></pre></div>
<p><img src="influ2_files/figure-html/unnamed-chunk-8-1.png" width="576"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myInfl</span><span class="op">$</span><span class="fu">influPlot</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="influ2_files/figure-html/unnamed-chunk-9-1.png" width="576"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">i1</span> <span class="op">&lt;-</span> <span class="va">myInfl</span><span class="op">$</span><span class="va">influences</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="op">-</span><span class="va">level</span>, names_to <span class="op">=</span> <span class="st">"variable"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>year <span class="op">=</span> <span class="va">level</span><span class="op">)</span></span>
<span><span class="va">i_month</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_influ.html">get_influ</a></span><span class="op">(</span>fit <span class="op">=</span> <span class="va">fit1</span>, group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span>, <span class="st">"month"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">delta</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>variable <span class="op">=</span> <span class="st">"month"</span><span class="op">)</span></span>
<span><span class="va">i_soak</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_influ.html">get_influ</a></span><span class="op">(</span>fit <span class="op">=</span> <span class="va">fit1</span>, group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span>, <span class="st">"soak"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">delta</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>variable <span class="op">=</span> <span class="st">"poly(soak, 3)"</span><span class="op">)</span></span>
<span><span class="va">i2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">i_month</span>, <span class="va">i_soak</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">i2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">i1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">variable</span>, group <span class="op">=</span> <span class="va">variable</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="va">variable</span> <span class="op">~</span> <span class="va">.</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="st">"Influence"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="influ2_files/figure-html/unnamed-chunk-10-1.png" alt="Comparison of influences produced by the original influ package (points) and the new influ2 calculation (lines)." width="576"><p class="caption">
Comparison of influences produced by the original influ package (points)
and the new influ2 calculation (lines).
</p>
</div>
</div>
<div class="section level2">
<h2 id="functions-for-exploring-models">Functions for exploring models<a class="anchor" aria-label="anchor" href="#functions-for-exploring-models"></a>
</h2>
<p>Here I evaluate model fit using loo and waic. Other options include
kfold, loo_subsample, bayes_R2, loo_R2, and marglik.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit1</span><span class="op">$</span><span class="va">criteria</span><span class="op">$</span><span class="va">loo</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Computed from 1500 by 15642 log-likelihood matrix</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          Estimate    SE</span></span>
<span><span class="co">#&gt; elpd_loo -25412.3 198.5</span></span>
<span><span class="co">#&gt; p_loo        67.9   1.9</span></span>
<span><span class="co">#&gt; looic     50824.7 397.0</span></span>
<span><span class="co">#&gt; ------</span></span>
<span><span class="co">#&gt; Monte Carlo SE of elpd_loo is 0.2.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; All Pareto k estimates are good (k &lt; 0.5).</span></span>
<span><span class="co">#&gt; See help('pareto-k-diagnostic') for details.</span></span>
<span><span class="va">fit1</span><span class="op">$</span><span class="va">criteria</span><span class="op">$</span><span class="va">waic</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Computed from 1500 by 15642 log-likelihood matrix</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;           Estimate    SE</span></span>
<span><span class="co">#&gt; elpd_waic -25412.2 198.5</span></span>
<span><span class="co">#&gt; p_waic        67.7   1.9</span></span>
<span><span class="co">#&gt; waic       50824.4 397.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 2 (0.0%) p_waic estimates greater than 0.4. We recommend trying loo instead.</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://mc-stan.org/loo/reference/loo_compare.html" class="external-link">loo_compare</a></span><span class="op">(</span><span class="va">fit1</span>, <span class="va">fit2</span>, criterion <span class="op">=</span> <span class="st">"loo"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="6%">
<col width="13%">
<col width="10%">
<col width="11%">
<col width="15%">
<col width="7%">
<col width="11%">
<col width="10%">
<col width="11%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">elpd_diff</th>
<th align="right">se_diff</th>
<th align="right">elpd_loo</th>
<th align="right">se_elpd_loo</th>
<th align="right">p_loo</th>
<th align="right">se_p_loo</th>
<th align="right">looic</th>
<th align="right">se_looic</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">fit2</td>
<td align="right">0.0</td>
<td align="right">0.0</td>
<td align="right">-23374.1</td>
<td align="right">124.2</td>
<td align="right">33.5</td>
<td align="right">1.0</td>
<td align="right">46748.3</td>
<td align="right">248.3</td>
</tr>
<tr class="even">
<td align="left">fit1</td>
<td align="right">-2038.2</td>
<td align="right">104.9</td>
<td align="right">-25412.3</td>
<td align="right">198.5</td>
<td align="right">67.9</td>
<td align="right">1.9</td>
<td align="right">50824.7</td>
<td align="right">397.0</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://mc-stan.org/loo/reference/loo_compare.html" class="external-link">loo_compare</a></span><span class="op">(</span><span class="va">fit1</span>, <span class="va">fit2</span>, criterion <span class="op">=</span> <span class="st">"waic"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="6%">
<col width="12%">
<col width="10%">
<col width="12%">
<col width="16%">
<col width="8%">
<col width="12%">
<col width="10%">
<col width="10%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">elpd_diff</th>
<th align="right">se_diff</th>
<th align="right">elpd_waic</th>
<th align="right">se_elpd_waic</th>
<th align="right">p_waic</th>
<th align="right">se_p_waic</th>
<th align="right">waic</th>
<th align="right">se_waic</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">fit2</td>
<td align="right">0.0</td>
<td align="right">0.0</td>
<td align="right">-23374.1</td>
<td align="right">124.2</td>
<td align="right">33.5</td>
<td align="right">1.0</td>
<td align="right">46748.2</td>
<td align="right">248.3</td>
</tr>
<tr class="even">
<td align="left">fit1</td>
<td align="right">-2038.1</td>
<td align="right">104.9</td>
<td align="right">-25412.2</td>
<td align="right">198.5</td>
<td align="right">67.7</td>
<td align="right">1.9</td>
<td align="right">50824.4</td>
<td align="right">397.0</td>
</tr>
</tbody>
</table>
<p>Bayesian R2 <code>bayes_R2</code> for the three model runs</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get_bayes_R2(fits)</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># cdi_month</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_bayesian_cdi.html">plot_bayesian_cdi</a></span><span class="op">(</span>fit <span class="op">=</span> <span class="va">fit2</span>, xfocus <span class="op">=</span> <span class="st">"month"</span>, yfocus <span class="op">=</span> <span class="st">"year"</span>, </span>
<span>                  xlab <span class="op">=</span> <span class="st">"Month"</span>, ylab <span class="op">=</span> <span class="st">"Year"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="influ2_files/figure-html/plot-cdi-re-1.png" alt="CDI plot for a random effect." width="576"><p class="caption">
CDI plot for a random effect.
</p>
</div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot_bayesian_cdi(fit = fit1, xfocus = "soak", yfocus = "year", </span></span>
<span><span class="co">#                   xlab = "Soak time (hours)", ylab = "Year")</span></span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot_bayesian_cdi(fit = fit2, xfocus = "depth", yfocus = "year", </span></span>
<span><span class="co">#                   xlab = "Depth (m)", ylab = "Year")</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fit1</span>, <span class="va">fit2</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_compare.html">plot_compare</a></span><span class="op">(</span>fits <span class="op">=</span> <span class="va">fits</span>, year <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="influ2_files/figure-html/unnamed-chunk-17-1.png" alt="Comparison plot of all model runs." width="576"><p class="caption">
Comparison plot of all model runs.
</p>
</div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_index.html">plot_index</a></span><span class="op">(</span>fit <span class="op">=</span> <span class="va">fit1</span>, year <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 18 rows containing missing values (`geom_line()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 18 rows containing missing values (`geom_point()`).</span></span></code></pre></div>
<div class="figure">
<img src="influ2_files/figure-html/unnamed-chunk-18-1.png" alt="Unstandardised versus standardised series." width="576"><p class="caption">
Unstandardised versus standardised series.
</p>
</div>
</div>
<div class="section level2">
<h2 id="diagnostics">Diagnostics<a class="anchor" aria-label="anchor" href="#diagnostics"></a>
</h2>
<p>The <code>influ2</code> package is based on the original
<code>influ</code> package which was developed to generate influence
plots. The <code>influ</code> package has functions that use outputs
from the <code>glm</code> function. The <code>influ2</code> package was
developed to use outputs from <code>brms</code> and relies heavily on
the R packages <code>ggplot2</code> and <code>dplyr</code>. This
vignette showcases the <code>influ2</code> package with a focus on model
diagnostics including posterior predictive distributions, residuals, and
quantile-quantile plots.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yrep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mc-stan.org/rstantools/reference/posterior_predict.html" class="external-link">posterior_predict</a></span><span class="op">(</span><span class="va">fit1</span>, ndraws <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ppc_dens_overlay(y = lobsters_per_pot$lobsters, yrep = yrep) + </span></span>
<span><span class="co">#   labs(x = "CPUE", y = "Density")</span></span>
<span></span>
<span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/PPC-discrete.html" class="external-link">ppc_bars</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">lobsters_per_pot</span><span class="op">$</span><span class="va">lobsters</span>, yrep <span class="op">=</span> <span class="va">yrep</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"CPUE"</span>, y <span class="op">=</span> <span class="st">"Density"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="influ2_files/figure-html/plot-bars-1.png" alt="Comparison of the empirical distribution of the data (y) to the distributions of simulated/replicated data (yrep) from the posterior predictive distribution." width="576"><p class="caption">
Comparison of the empirical distribution of the data (y) to the
distributions of simulated/replicated data (yrep) from the posterior
predictive distribution.
</p>
</div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/PPC-distributions.html" class="external-link">ppc_ecdf_overlay</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">lobsters_per_pot</span><span class="op">$</span><span class="va">lobsters</span>, yrep <span class="op">=</span> <span class="va">yrep</span>, discrete <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="influ2_files/figure-html/plot-ecdf-1.png" alt="Posterior predictive check." width="576"><p class="caption">
Posterior predictive check.
</p>
</div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># loo &lt;- loo(fit1, save_psis = TRUE)</span></span>
<span><span class="co"># psis &lt;- loo$psis_object</span></span>
<span><span class="co"># lw &lt;- weights(psis)</span></span>
<span><span class="co"># yrep &lt;- posterior_predict(fit1)</span></span>
<span><span class="co"># ppc_loo_pit_qq(y = lobsters_per_pot$lobsters, yrep = yrep, lw = lw)</span></span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot_qq(fit = fit1)</span></span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot_predicted_residuals(fit = fit1, trend = "loess")</span></span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot_predicted_residuals(fit = fit1, trend = "lm") +</span></span>
<span><span class="co">#   facet_wrap(year ~ .)</span></span></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># A new style of residual plot</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="va">fit1</span></span>
<span></span>
<span><span class="co"># Extract predicted values</span></span>
<span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"pred."</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract residuals</span></span>
<span><span class="va">resid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">resid</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"resid."</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">resid</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">resid</span>, <span class="va">pred</span>, <span class="va">lobsters_per_pot</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">resid.Estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_pointrange</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">resid.Q2.5</span>, ymax <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">resid.Q97.5</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="va">month</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># geom_errorbarh(aes(xmax = .data$pred.Q2.5, xmin = .data$pred.Q97.5, height = 0), alpha = 0.75) +</span></span>
<span>  <span class="co"># labs(x = "Predicted values", y = "Residuals") +</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="influ2_files/figure-html/unnamed-chunk-22-1.png" alt="Residuals and a loess smoother by year." width="960"><p class="caption">
Residuals and a loess smoother by year.
</p>
</div>
</div>
<div class="section level2">
<h2 id="implied-residuals">Implied residuals<a class="anchor" aria-label="anchor" href="#implied-residuals"></a>
</h2>
<p>Implied coefficients (points) are calculated as the normalised
fishing year coefficient (grey line) plus the mean of the standardised
residuals in each year for each category of a variable. These values
approximate the coefficients obtained when an area x year interaction
term is fitted, particularly for those area x year combinations which
have a substantial proportion of the records. The error bars indicate
one standard error of the standardised residuals. The information at the
top of each panel identifies the plotted category, provides the
correlation coefficient (rho) between the category year index and the
overall model index, and the number of records supporting the
category.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot_implied_residuals(fit = fit2, data = lobsters_per_pot, </span></span>
<span><span class="co">#                        year = "year", groups = "month") +</span></span>
<span><span class="co">#   theme(axis.text.x = element_text(angle = 45, hjust = 1))</span></span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot_implied_residuals(fit = fit2, data = lobsters_per_pot, </span></span>
<span><span class="co">#                        year = "year", groups = "depth") +</span></span>
<span><span class="co">#   theme(axis.text.x = element_text(angle = 45, hjust = 1))</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="functions-for-generating-outputs-for-stock-assessment">Functions for generating outputs for stock assessment<a class="anchor" aria-label="anchor" href="#functions-for-generating-outputs-for-stock-assessment"></a>
</h2>
<p>Finally, in order to fit to the data in a stock assessment model then
indices can be produced using the <code>get_index</code> function. The
<code>Estimate</code> and <code>Est.Error</code> columns are what should
be used in stock assessment.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">unstd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_unstandarsied.html">get_unstandarsied</a></span><span class="op">(</span>fit <span class="op">=</span> <span class="va">fit2</span>, year <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span></span>
<span><span class="va">cpue0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_index.html">get_index</a></span><span class="op">(</span>fit <span class="op">=</span> <span class="va">fit2</span>, year <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cpue0</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Unstandardised <span class="op">=</span> <span class="va">unstd</span><span class="op">$</span><span class="va">Median</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Year</span>, <span class="va">Unstandardised</span>, <span class="va">Mean</span>, <span class="va">SD</span>, <span class="va">Qlower</span>, <span class="va">Median</span>, <span class="va">Qupper</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Year</th>
<th align="right">Unstandardised</th>
<th align="right">Mean</th>
<th align="right">SD</th>
<th align="right">Qlower</th>
<th align="right">Median</th>
<th align="right">Qupper</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">2000</td>
<td align="right">0.885</td>
<td align="right">0.915</td>
<td align="right">0.068</td>
<td align="right">0.786</td>
<td align="right">0.917</td>
<td align="right">1.053</td>
</tr>
<tr class="even">
<td align="left">2001</td>
<td align="right">1.028</td>
<td align="right">1.044</td>
<td align="right">0.079</td>
<td align="right">0.902</td>
<td align="right">1.043</td>
<td align="right">1.202</td>
</tr>
<tr class="odd">
<td align="left">2002</td>
<td align="right">1.021</td>
<td align="right">1.034</td>
<td align="right">0.078</td>
<td align="right">0.894</td>
<td align="right">1.034</td>
<td align="right">1.193</td>
</tr>
<tr class="even">
<td align="left">2003</td>
<td align="right">1.090</td>
<td align="right">1.100</td>
<td align="right">0.081</td>
<td align="right">0.952</td>
<td align="right">1.101</td>
<td align="right">1.266</td>
</tr>
<tr class="odd">
<td align="left">2004</td>
<td align="right">0.897</td>
<td align="right">0.890</td>
<td align="right">0.068</td>
<td align="right">0.765</td>
<td align="right">0.890</td>
<td align="right">1.029</td>
</tr>
<tr class="even">
<td align="left">2005</td>
<td align="right">1.139</td>
<td align="right">1.238</td>
<td align="right">0.091</td>
<td align="right">1.067</td>
<td align="right">1.238</td>
<td align="right">1.423</td>
</tr>
<tr class="odd">
<td align="left">2006</td>
<td align="right">0.834</td>
<td align="right">0.808</td>
<td align="right">0.063</td>
<td align="right">0.691</td>
<td align="right">0.809</td>
<td align="right">0.934</td>
</tr>
<tr class="even">
<td align="left">2007</td>
<td align="right">0.876</td>
<td align="right">0.873</td>
<td align="right">0.066</td>
<td align="right">0.749</td>
<td align="right">0.872</td>
<td align="right">1.008</td>
</tr>
<tr class="odd">
<td align="left">2008</td>
<td align="right">0.911</td>
<td align="right">0.939</td>
<td align="right">0.070</td>
<td align="right">0.814</td>
<td align="right">0.938</td>
<td align="right">1.087</td>
</tr>
<tr class="even">
<td align="left">2009</td>
<td align="right">0.768</td>
<td align="right">0.734</td>
<td align="right">0.056</td>
<td align="right">0.630</td>
<td align="right">0.734</td>
<td align="right">0.850</td>
</tr>
<tr class="odd">
<td align="left">2010</td>
<td align="right">0.606</td>
<td align="right">0.579</td>
<td align="right">0.045</td>
<td align="right">0.494</td>
<td align="right">0.578</td>
<td align="right">0.673</td>
</tr>
<tr class="even">
<td align="left">2011</td>
<td align="right">0.620</td>
<td align="right">0.551</td>
<td align="right">0.045</td>
<td align="right">0.465</td>
<td align="right">0.551</td>
<td align="right">0.646</td>
</tr>
<tr class="odd">
<td align="left">2012</td>
<td align="right">0.700</td>
<td align="right">0.653</td>
<td align="right">0.052</td>
<td align="right">0.560</td>
<td align="right">0.653</td>
<td align="right">0.761</td>
</tr>
<tr class="even">
<td align="left">2013</td>
<td align="right">1.200</td>
<td align="right">1.189</td>
<td align="right">0.095</td>
<td align="right">1.017</td>
<td align="right">1.188</td>
<td align="right">1.388</td>
</tr>
<tr class="odd">
<td align="left">2014</td>
<td align="right">1.373</td>
<td align="right">1.428</td>
<td align="right">0.107</td>
<td align="right">1.238</td>
<td align="right">1.427</td>
<td align="right">1.651</td>
</tr>
<tr class="even">
<td align="left">2015</td>
<td align="right">1.666</td>
<td align="right">1.652</td>
<td align="right">0.130</td>
<td align="right">1.416</td>
<td align="right">1.655</td>
<td align="right">1.923</td>
</tr>
<tr class="odd">
<td align="left">2016</td>
<td align="right">1.620</td>
<td align="right">1.750</td>
<td align="right">0.127</td>
<td align="right">1.519</td>
<td align="right">1.749</td>
<td align="right">2.014</td>
</tr>
<tr class="even">
<td align="left">2017</td>
<td align="right">1.615</td>
<td align="right">1.683</td>
<td align="right">0.132</td>
<td align="right">1.438</td>
<td align="right">1.684</td>
<td align="right">1.954</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">cpue0</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Year</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_pointrange</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Median</span>, ymin <span class="op">=</span> <span class="va">Qlower</span>, ymax <span class="op">=</span> <span class="va">Qupper</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Mean</span>, group <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span>, expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html" class="external-link">expansion</a></span><span class="op">(</span>mult <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="st">"CPUE"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="influ2_files/figure-html/unnamed-chunk-26-1.png" width="576"></p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cpue1</span> <span class="op">&lt;-</span> <span class="va">cpue0</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Type <span class="op">=</span> <span class="st">"Estimate"</span><span class="op">)</span></span>
<span><span class="va">cpue2</span> <span class="op">&lt;-</span> <span class="va">cpue1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Type <span class="op">=</span> <span class="st">"Simulated wrong"</span><span class="op">)</span></span>
<span><span class="va">cpue3</span> <span class="op">&lt;-</span> <span class="va">cpue1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Type <span class="op">=</span> <span class="st">"Simulated"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">ii</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">cpue1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">sdd</span> <span class="op">&lt;-</span> <span class="va">cpue1</span><span class="op">$</span><span class="va">SD</span><span class="op">[</span><span class="va">ii</span><span class="op">]</span> <span class="co"># this is wrong</span></span>
<span>  <span class="va">r1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5000</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">cpue1</span><span class="op">$</span><span class="va">Mean</span><span class="op">[</span><span class="va">ii</span><span class="op">]</span><span class="op">)</span>, <span class="va">sdd</span><span class="op">)</span></span>
<span>  <span class="va">cpue2</span><span class="op">$</span><span class="va">Median</span><span class="op">[</span><span class="va">ii</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">r1</span><span class="op">)</span></span>
<span>  <span class="va">cpue2</span><span class="op">$</span><span class="va">Qlower</span><span class="op">[</span><span class="va">ii</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">r1</span>, probs <span class="op">=</span> <span class="fl">0.025</span><span class="op">)</span></span>
<span>  <span class="va">cpue2</span><span class="op">$</span><span class="va">Qupper</span><span class="op">[</span><span class="va">ii</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">r1</span>, probs <span class="op">=</span> <span class="fl">0.975</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">sdd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">cpue1</span><span class="op">$</span><span class="va">SD</span><span class="op">[</span><span class="va">ii</span><span class="op">]</span> <span class="op">/</span> <span class="va">cpue1</span><span class="op">$</span><span class="va">Mean</span><span class="op">[</span><span class="va">ii</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">r1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5000</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">cpue1</span><span class="op">$</span><span class="va">Median</span><span class="op">[</span><span class="va">ii</span><span class="op">]</span><span class="op">)</span>, <span class="va">sdd</span><span class="op">)</span></span>
<span>  <span class="va">cpue3</span><span class="op">$</span><span class="va">Median</span><span class="op">[</span><span class="va">ii</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">r1</span><span class="op">)</span></span>
<span>  <span class="va">cpue3</span><span class="op">$</span><span class="va">Qlower</span><span class="op">[</span><span class="va">ii</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">r1</span>, probs <span class="op">=</span> <span class="fl">0.025</span><span class="op">)</span></span>
<span>  <span class="va">cpue3</span><span class="op">$</span><span class="va">Qupper</span><span class="op">[</span><span class="va">ii</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">r1</span>, probs <span class="op">=</span> <span class="fl">0.975</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">cpue1</span>, <span class="va">cpue2</span>, <span class="va">cpue3</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Year</span>, y <span class="op">=</span> <span class="va">Median</span>, colour <span class="op">=</span> <span class="va">Type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_pointrange</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">Qlower</span>, ymax <span class="op">=</span> <span class="va">Qupper</span><span class="op">)</span>, </span>
<span>                  position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span>, expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html" class="external-link">expansion</a></span><span class="op">(</span>mult <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="st">"CPUE"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="influ2_files/figure-html/unnamed-chunk-27-1.png" alt="Simulating from a lognormal distribution and comparing with table values. Simulating with the wrong SD underestimates the uncertainty at low values." width="576"><p class="caption">
Simulating from a lognormal distribution and comparing with table
values. Simulating with the wrong SD underestimates the uncertainty at
low values.
</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Darcy Webber.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
