---
title: "diagnostics"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{diagnostics}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

The `influ2` package is based on the original `influ` package which was developed to generate influence plots. The `influ` package has functions that use outputs from the `glm` function. The `influ2` package was developed to use outputs from `brms` and relies heavily on the R packages `ggplot2` and `dplyr`. This vignette showcases the `influ2` package with a focus on model diagnostics including posterior predictive distributions, residuals, and quantile-quantile plots.

```{r echo=TRUE, fig.height=6, fig.width=6, message=FALSE}
library(brms)
library(influ2)
library(bayesplot)

# Get some data to use
data(iris)

iris2 <- iris %>% 
  mutate(CPUE = Petal.Length, 
         Year = factor(Sepal.Width * 10 + 1970), 
         Area = factor(round(Petal.Width)), 
         Duration = Sepal.Length,
         Duration2 = cut(Sepal.Length, 15)) %>%
  select(CPUE, Year, Species, Area, Duration, Duration2)
glimpse(iris2)
```

```{r echo=TRUE, fig.height=6, fig.width=6, message=FALSE}
fit <- brm(CPUE ~ Year + Species, data = iris2, family = Gamma(link = "log"), refresh = 0)
```

```{r echo=TRUE, fig.height=6, fig.width=6, message=FALSE}
yrep <- posterior_predict(fit, draws = 500)
ppc_dens_overlay(y = iris2$CPUE, yrep = yrep[1:100,]) + 
  theme_bw() +
  labs(x = "CPUE", y = "Density")

plot_predicted_residuals(fit)

plot_qq(fit)
```
